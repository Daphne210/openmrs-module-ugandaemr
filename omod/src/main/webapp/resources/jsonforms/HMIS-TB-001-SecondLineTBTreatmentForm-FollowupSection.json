{
  "name": "DR TB: HMIS TB 001 Second Line TB Treatment Card - Followup Section",
  "version": "4.0.0",
  "description": "This form captures return visits/followup data of the DR TB Treatment program",
  "encounter": "DR TB Encounter (Followup)",
  "encounterType": "41f8609d-e13b-4dff-8379-47ac5876512e",
  "uuid": "f2755f27-6ae9-4da8-b80a-9bac2a4e0d17",
  "processor": "EncounterFormProcessor",
  "published": true,
  "retired": false,
  "pages": [
    {
      "label": "DR TB Followup Page",
      "sections": [
        {
          "label": "Client Information",
          "isExpanded": "true",
          "questions": [
            {
              "label": "DR TB Reg No.",
              "type": "obs",
              "id": "drTbNo",
              "questionOptions": {
                "rendering": "text",
                "concept": "2c64410a-9f08-4b4f-9d00-23105e8730d4",
                "conceptMappings": [],
                "answers": []
              },
              "validators": []
            },
            {
              "label": "Unit TB No.",
              "type": "obs",
              "id": "unitTbNo",
              "questionOptions": {
                "rendering": "text",
                "concept": "2e2ec250-f5d3-4de7-8c70-a458f42441e6",
                "conceptMappings": [],
                "answers": []
              }
            }
          ]
        },
        {
          "label": "Follow Up Information",
          "isExpanded": "true",
          "questions": [
            {
              "label": "Followup Visit",
              "type": "obs",
              "id": "followupVisit",
              "questionOptions": {
                "rendering": "select",
                "concept": "",
                "answers": [
                  {
                    "concept": "",
                    "label": "Visit 1",
                    "conceptMappings": []
                  },
                  {
                    "concept": "",
                    "label": "Visit 2",
                    "conceptMappings": []
                  },
                  {
                    "concept": "",
                    "label": "Visit 3",
                    "conceptMappings": []
                  },
                  {
                    "concept": "",
                    "label": "Visit 4",
                    "conceptMappings": []
                  },
                  {
                    "concept": "",
                    "label": "Visit 5",
                    "conceptMappings": []
                  },
                  {
                    "concept": "",
                    "label": "Visit 6",
                    "conceptMappings": []
                  }
                ]
              }
            },
            {
              "label": "Visit Date",
              "type": "encounterDatetime",
              "id": "encDate",
              "questionOptions": {
                "rendering": "date",
                "allowFutureDates": "false"
              }
            },
            {
              "label": "DR TB Contacts",
              "type": "obsGroup",
              "id": "drTbContact",
              "questionOptions": {
                "rendering": "repeating",
                "concept": "",
                "conceptMappings": [],
                "answers": []
              },
              "questions": [
                {
                  "label": "No. of Contacts listed",
                  "type": "obs",
                  "id": "listedContactsNumber",
                  "questionOptions": {
                    "rendering": "number",
                    "concept": "",
                    "conceptMappings": [],
                    "answers": []
                  }
                },
                {
                  "label": "No. of Contacts Screened on visit",
                  "type": "obs",
                  "id": "screendContactsNumber",
                  "questionOptions": {
                    "rendering": "number",
                    "concept": "",
                    "conceptMappings": [],
                    "answers": []
                  }
                },
                {
                  "label": "No. of Contacts Diagnosed on visit",
                  "type": "obs",
                  "id": "diagnosedContactsNumber",
                  "questionOptions": {
                    "rendering": "number",
                    "concept": "",
                    "conceptMappings": [],
                    "answers": []
                  }
                }
              ],
              "validators": []
            }
          ]
        },
        {
          "label": "TB/HIV Activties",
          "isExpanded": "true",
          "questions": [
            {
              "label": "HIV Status",
              "type": "obs",
              "id": "hivStatus",
              "required": "false",
              "questionOptions": {
                "concept": "dce0e886-30ab-102d-86b0-7a5022ba4115",
                "rendering": "select",
                "answers": [
                  {
                    "concept": "6e46ac6b-944d-4a66-a994-b99ae90d4fed",
                    "label": "KPos - Known HIV positive at TB diagnosis"
                  },
                  {
                    "concept": "dcdf4653-30ab-102d-86b0-7a5022ba4115",
                    "label": "Neg - Negative"
                  },
                  {
                    "concept": "f72917e2-0bfb-4d73-b87b-643d7180f338",
                    "label": "NPos - Newly tested HIV positive at TB diagnosis"
                  },
                  {
                    "concept": "dcd6865a-30ab-102d-86b0-7a5022ba4115",
                    "label": "Unk - Unknown"
                  }
                ]
              }
            },
            {
              "label": "HIV Test Date",
              "type": "obs",
              "id": "hivTestDate",
              "questionOptions": {
                "rendering": "date",
                "concept": "d2f31713-aada-4d0d-9340-014b2371bdd8"
              },
              "validators": [
                {
                  "type": "date",
                  "allowFutureDates": "false"
                }
              ],
              "hide": {
                "hideWhenExpression": "isEmpty(hivStatus) || hivStatus == 'dcd6865a-30ab-102d-86b0-7a5022ba4115'"
              }
            },
            {
              "label": "WHO Clinical Stage",
              "type": "obs",
              "id": "currentWHOClinicStage",
              "questionOptions": {
                "rendering": "select",
                "concept": "dcdff274-30ab-102d-86b0-7a5022ba4115",
                "calculate": {
                  "calculateExpression": "resolve(api.getLatestObs(patient.id, 'dcdff274-30ab-102d-86b0-7a5022ba4115')).then(obs => obs.valueCodeableConcept?.coding[0]?.code)"
                },
                "answers": [
                  {
                    "concept": "dcda2bc2-30ab-102d-86b0-7a5022ba4115",
                    "label": "Stage 1",
                    "conceptMappings": []
                  },
                  {
                    "concept": "dcda3251-30ab-102d-86b0-7a5022ba4115",
                    "label": "Stage 2",
                    "conceptMappings": []
                  },
                  {
                    "concept": "dcda3663-30ab-102d-86b0-7a5022ba4115",
                    "label": "Stage 3",
                    "conceptMappings": []
                  },
                  {
                    "concept": "dcda3a80-30ab-102d-86b0-7a5022ba4115",
                    "label": "Stage 4",
                    "conceptMappings": []
                  },
                  {
                    "concept": "dd25e735-30ab-102d-86b0-7a5022ba4115",
                    "label": "Stage T1",
                    "conceptMappings": []
                  },
                  {
                    "concept": "dd2666a5-30ab-102d-86b0-7a5022ba4115",
                    "label": "Stage T2",
                    "conceptMappings": []
                  },
                  {
                    "concept": "dd266d64-30ab-102d-86b0-7a5022ba4115",
                    "label": "Stage T3",
                    "conceptMappings": []
                  },
                  {
                    "concept": "dd269c18-30ab-102d-86b0-7a5022ba4115",
                    "label": "Stage T4",
                    "conceptMappings": []
                  }
                ]
              },
              "validators": [],
              "hide": {
                "hideWhenExpression": "hivStatus !== '6e46ac6b-944d-4a66-a994-b99ae90d4fed' && hivStatus !== 'f72917e2-0bfb-4d73-b87b-643d7180f338'"
              }
            },
            {
              "label": "CD4",
              "type": "obs",
              "id": "cd4",
              "questionOptions": {
                "rendering": "number",
                "concept": "dcbcba2c-30ab-102d-86b0-7a5022ba4115",
                "conceptMappings": [],
                "answers": []
              },
              "validators": [],
              "hide": {
                "hideWhenExpression": "hivStatus !== '6e46ac6b-944d-4a66-a994-b99ae90d4fed' && hivStatus !== 'f72917e2-0bfb-4d73-b87b-643d7180f338'"
              }
            },
            {
              "label": "Date CD4 Sample Collected",
              "type": "obs",
              "required": "false",
              "id": "dateStarted",
              "questionOptions": {
                "rendering": "date",
                "concept": "1ae6f663-d3b0-4527-bb8f-4ed18a9ca96c",
                "calculate": {
                  "calculateExpression": "resolve(api.getLatestObs(patient.id, '1ae6f663-d3b0-4527-bb8f-4ed18a9ca96c')).then(obs => obs?.valueDateTime)"
                },
                "conceptMappings": [],
                "answers": []
              },
              "validators": [],
              "hide": {
                "hideWhenExpression": "hivStatus !== '6e46ac6b-944d-4a66-a994-b99ae90d4fed' && hivStatus !== 'f72917e2-0bfb-4d73-b87b-643d7180f338'"
              }
            },
            {
              "label": "Viral Load",
              "type": "obs",
              "id": "viralLoad",
              "questionOptions": {
                "rendering": "number",
                "concept": "dc8d83e3-30ab-102d-86b0-7a5022ba4115",
                "conceptMappings": [],
                "answers": []
              },
              "validators": [],
              "hide": {
                "hideWhenExpression": "hivStatus !== '6e46ac6b-944d-4a66-a994-b99ae90d4fed' && hivStatus !== 'f72917e2-0bfb-4d73-b87b-643d7180f338'"
              }
            },
            {
              "label": "HIV Viral Load Date",
              "type": "obs",
              "required": "false",
              "id": "vlDate",
              "questionOptions": {
                "rendering": "date",
                "concept": "0b434cfa-b11c-4d14-aaa2-9aed6ca2da88",
                "calculate": {
                  "calculateExpression": "resolve(api.getLatestObs(patient.id, '0b434cfa-b11c-4d14-aaa2-9aed6ca2da88')).then(obs => obs.valueDateTime)"
                },
                "conceptMappings": [],
                "answers": []
              },
              "validators": [],
              "hide": {
                "hideWhenExpression": "hivStatus !== '6e46ac6b-944d-4a66-a994-b99ae90d4fed' && hivStatus !== 'f72917e2-0bfb-4d73-b87b-643d7180f338'"
              }
            },
            {
              "label": "CPT/Dapson",
              "type": "obs",
              "id": "cptStatus",
              "questionOptions": {
                "rendering": "radio",
                "concept": "bb77f9f0-9743-4c60-8e70-b20b5e800a50",
                "answers": [
                  {
                    "concept": "1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
                    "label": "Yes"
                  },
                  {
                    "concept": "1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
                    "label": "No"
                  }
                ]
              },
              "validators": [],
              "hide": {
                "hideWhenExpression": "hivStatus !== '6e46ac6b-944d-4a66-a994-b99ae90d4fed' && hivStatus !== 'f72917e2-0bfb-4d73-b87b-643d7180f338'"
              }
            },
            {
              "label": "Date Started CPT",
              "type": "obs",
              "id": "cptStartDate",
              "questionOptions": {
                "rendering": "date",
                "concept": "481c5fdb-4719-4be3-84c0-a64172a426c7"
              },
              "validators": [
                {
                  "type": "date",
                  "allowFutureDates": "false"
                }
              ],
              "hide": {
                "hideWhenExpression": "isEmpty(cptStatus) || cptStatus !=='1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'"
              }
            },
            {
              "type": "patientIdentifier",
              "label": "ART Number",
              "questionInfo": "",
              "id": "artNumber",
              "default": "",
              "required": "false",
              "questionOptions": {
                "rendering": "text",
                "identifierType": "e1731641-30ab-102d-86b0-7a5022ba4115"
              },
              "hide": {
                "hideWhenExpression": "hivStatus !== '6e46ac6b-944d-4a66-a994-b99ae90d4fed' && hivStatus !== 'f72917e2-0bfb-4d73-b87b-643d7180f338'"
              }
            },
            {
              "label": "ART Start Date",
              "type": "obs",
              "id": "artStartDate",
              "questionOptions": {
                "rendering": "date",
                "concept": "ab505422-26d9-41f1-a079-c3d222000440",
                "calculate": {
                  "calculateExpression": "resolve(api.getLatestObs(patient?.id, 'ab505422-26d9-41f1-a079-c3d222000440')).then(obs => obs?.valueDateTime)"
                }
              },
              "validators": [
                {
                  "type": "date",
                  "allowFutureDates": "false"
                }
              ],
              "hide": {
                "hideWhenExpression": "hivStatus !== '6e46ac6b-944d-4a66-a994-b99ae90d4fed' && hivStatus !== 'f72917e2-0bfb-4d73-b87b-643d7180f338'"
              }
            }
          ]
        }
      ]
    }
  ],
  "referencedForms": []
}